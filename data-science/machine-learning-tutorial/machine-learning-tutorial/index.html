
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content=" A knowledge management system for the metrics service line">
      
      
      
        <meta name="author" content="Erik Anderson">
      
      
      <link rel="shortcut icon" href="../../../img/ei-logo-black.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.5">
    
    
      
        <title>Machine Learning Tutorial - EI Metrics</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.77f3fd56.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.7fa14f5b.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-151885346-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="indigo">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#machine-learning-tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="EI Metrics" class="md-header__button md-logo" aria-label="EI Metrics">
      
  <img src="../../../img/ei-logo-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EI Metrics
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Machine Learning Tutorial
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="EI Metrics" class="md-nav__button md-logo" aria-label="EI Metrics">
      
  <img src="../../../img/ei-logo-white.png" alt="logo">

    </a>
    EI Metrics
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Project Portfolio
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Project Portfolio" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Project Portfolio
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../portfolio/project-portfolio/" class="md-nav__link">
        Portfolio
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      <label class="md-nav__link" for="__nav_2_2">
        Case Studies
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Case Studies" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Case Studies
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../portfolio/ggs-hqt/ggs-hqt/" class="md-nav__link">
        Giant Garter Snake Habitat Quantification Tool
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../metrics-services/how-we-work/" class="md-nav__link">
        Metrics Services
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Metrics Design Philosophy
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Metrics Design Philosophy" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Metrics Design Philosophy
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../metrics-design/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../metrics-design/step1-start-at-the-end/" class="md-nav__link">
        Step 1: Start at the End
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../metrics-design/step2-map-it/" class="md-nav__link">
        Step 2: Map It
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../metrics-design/step3-develop-empathy/" class="md-nav__link">
        Step 3: Develop Empathy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../metrics-design/step4-define-the-problem/" class="md-nav__link">
        Step 4: Define the Problem
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../metrics-design/step5-identify-a-solution/" class="md-nav__link">
        Step 5: Identify a Solution
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../metrics-design/step6-implement/" class="md-nav__link">
        Step 6: Implement
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../metrics-design/step7-adapt/" class="md-nav__link">
        Step 7: Iterate & Adapt
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        The Basics
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="The Basics" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          The Basics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../the-basics/getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Git
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Git" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Git
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../git/install-configure-git/" class="md-nav__link">
        Install Git
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../git/initializing-git/" class="md-nav__link">
        Create Project
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../git/common-workflow/" class="md-nav__link">
        Common Workflow
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../git/collaborating-with-git/" class="md-nav__link">
        Collaborating with Git
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../git/additional-reference/" class="md-nav__link">
        Additional Reference
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Development
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/command-line-tools/" class="md-nav__link">
        Command Line Tools
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/scheduling-tasks/" class="md-nav__link">
        Scheduling Tasks
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/secrets/" class="md-nav__link">
        Secrets
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/environment-variables/" class="md-nav__link">
        Environment Variables
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/virtual-environments/" class="md-nav__link">
        Virtual Environments
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        Deployment
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/deployment-overview/" class="md-nav__link">
        Deployment Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/heroku/" class="md-nav__link">
        Heroku
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/google-api/" class="md-nav__link">
        Google API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/gs-app/" class="md-nav__link">
        Google Sheets App
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/lightweight-backends/" class="md-nav__link">
        Lightweight Backends
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        Data Management
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Data Management" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Data Management
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../data-management/database-overview/" class="md-nav__link">
        Database Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../data-management/postgres-tutorial/" class="md-nav__link">
        PostgreSQL Tutorial
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../data-management/neo4j-overview/" class="md-nav__link">
        Neo4j Graph Databases
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../data-management/neo4j-tutorial/" class="md-nav__link">
        Neo4j Tutorial
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../data-management/neo4j-advanced/" class="md-nav__link">
        Neo4j Advanced
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" checked>
      
      <label class="md-nav__link" for="__nav_10">
        Data Analysis
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Data Analysis" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Data Analysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Machine Learning Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Machine Learning Tutorial
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-challenge" class="md-nav__link">
    The Challenge
  </a>
  
    <nav class="md-nav" aria-label="The Challenge">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-statements" class="md-nav__link">
    Import Statements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-data" class="md-nav__link">
    Import Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explore-data-and-preparation-steps" class="md-nav__link">
    Explore Data and Preparation Steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-training-data-for-sckit-learn" class="md-nav__link">
    Build the Training Data for sckit-learn
  </a>
  
    <nav class="md-nav" aria-label="Build the Training Data for sckit-learn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#save-the-output" class="md-nav__link">
    Save the output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splitting-the-data-for-testing" class="md-nav__link">
    Splitting the data for testing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pairing-y-with-x" class="md-nav__link">
    Pairing y with X
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-the-classifier" class="md-nav__link">
    Training the Classifier
  </a>
  
    <nav class="md-nav" aria-label="Training the Classifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    Validation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improving-model-accuracy" class="md-nav__link">
    Improving Model Accuracy
  </a>
  
    <nav class="md-nav" aria-label="Improving Model Accuracy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standardizing-values" class="md-nav__link">
    Standardizing Values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#balancing-classes" class="md-nav__link">
    Balancing Classes
  </a>
  
    <nav class="md-nav" aria-label="Balancing Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-unbalanced-are-the-classes-now" class="md-nav__link">
    How unbalanced are the classes now?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-model-random-forests" class="md-nav__link">
    Alternative Model: Random Forests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confusion-matrix" class="md-nav__link">
    Confusion Matrix
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predicting-on-the-image" class="md-nav__link">
    Predicting on the Image
  </a>
  
    <nav class="md-nav" aria-label="Predicting on the Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visualize-the-results" class="md-nav__link">
    Visualize the Results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improving-our-model-accuracy" class="md-nav__link">
    Improving our Model Accuracy
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      <label class="md-nav__link" for="__nav_11">
        Data Visualization
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Data Visualization" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Data Visualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../data-visualization/data-visualization/" class="md-nav__link">
        Data Visualization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../data-visualization/dashboards/" class="md-nav__link">
        Dashboards
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      <label class="md-nav__link" for="__nav_12">
        Python Packages
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Python Packages" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Python Packages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/dash/" class="md-nav__link">
        Dash
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/py2neo/" class="md-nav__link">
        py2neo
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" type="checkbox" id="__nav_13" >
      
      <label class="md-nav__link" for="__nav_13">
        Additional Resources
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Additional Resources" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          Additional Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../additional-resources/scoping/" class="md-nav__link">
        Scoping Canvas
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../additional-resources/product-definition/" class="md-nav__link">
        Product Definition
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../additional-resources/specification-doc/" class="md-nav__link">
        Product Specification
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../additional-resources/persona-guide/" class="md-nav__link">
        Persona Development Guide
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../additional-resources/interview-guide/" class="md-nav__link">
        Interview Guide
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../additional-resources/user-testing-guide/" class="md-nav__link">
        User Testing Guide
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_14" type="checkbox" id="__nav_14" >
      
      <label class="md-nav__link" for="__nav_14">
        How to Maintain This Site
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="How to Maintain This Site" data-md-level="1">
        <label class="md-nav__title" for="__nav_14">
          <span class="md-nav__icon md-icon"></span>
          How to Maintain This Site
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../maintenance/development-guidance/" class="md-nav__link">
        Development Guide
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../maintenance/tips-and-tricks/" class="md-nav__link">
        Tips & Tricks
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-challenge" class="md-nav__link">
    The Challenge
  </a>
  
    <nav class="md-nav" aria-label="The Challenge">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-statements" class="md-nav__link">
    Import Statements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-data" class="md-nav__link">
    Import Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explore-data-and-preparation-steps" class="md-nav__link">
    Explore Data and Preparation Steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-training-data-for-sckit-learn" class="md-nav__link">
    Build the Training Data for sckit-learn
  </a>
  
    <nav class="md-nav" aria-label="Build the Training Data for sckit-learn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#save-the-output" class="md-nav__link">
    Save the output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splitting-the-data-for-testing" class="md-nav__link">
    Splitting the data for testing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pairing-y-with-x" class="md-nav__link">
    Pairing y with X
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-the-classifier" class="md-nav__link">
    Training the Classifier
  </a>
  
    <nav class="md-nav" aria-label="Training the Classifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    Validation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improving-model-accuracy" class="md-nav__link">
    Improving Model Accuracy
  </a>
  
    <nav class="md-nav" aria-label="Improving Model Accuracy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standardizing-values" class="md-nav__link">
    Standardizing Values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#balancing-classes" class="md-nav__link">
    Balancing Classes
  </a>
  
    <nav class="md-nav" aria-label="Balancing Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-unbalanced-are-the-classes-now" class="md-nav__link">
    How unbalanced are the classes now?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-model-random-forests" class="md-nav__link">
    Alternative Model: Random Forests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confusion-matrix" class="md-nav__link">
    Confusion Matrix
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predicting-on-the-image" class="md-nav__link">
    Predicting on the Image
  </a>
  
    <nav class="md-nav" aria-label="Predicting on the Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visualize-the-results" class="md-nav__link">
    Visualize the Results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improving-our-model-accuracy" class="md-nav__link">
    Improving our Model Accuracy
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="machine-learning-tutorial">Machine Learning Tutorial<a class="headerlink" href="#machine-learning-tutorial" title="Permanent link">&para;</a></h1>
<p>This tutorial is intended to illustrate a typical workflow for machine learning to solve a land use and land cover classification problem.</p>
<p>Land Use and Land Cover classifications are used to identify the dominant land cover or land use type in an area. We use the Naive Bayes and Random Forest classifiers, as implemented within <code>scikit-learn</code> library. This tutorial borrows heavily from the very helpful <a href="http://patrickgray.me/open-geo-tutorial/chapter_5_classification.html">tutorial</a> developed by Chris Holden and updated by Patrick Gray. Also used: <code>rasterio</code>, <code>geopandas</code>, <code>numpy</code>, <code>pandas</code>, <code>shapely</code>, and <code>matplotlib</code>.</p>
<h2 id="the-challenge">The Challenge<a class="headerlink" href="#the-challenge" title="Permanent link">&para;</a></h2>
<p>Our client required a rapid approach for evaluating the benefits of conservation projects to Mule Deer. We proposed using Ecological State and Transition Models (STMs) as the basis for the evaluation. The NRCS has developed STMs for the dominant ecological sites within the region, however only a subset of the region was mapped. We use vegetation data (provided by the <a href="https:/www.rangelands.app">Rangelands App</a>) and other environmental variables to predict STM for the unmapped areas of the range.   </p>
<h3 id="import-statements">Import Statements<a class="headerlink" href="#import-statements" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.mask</span> <span class="kn">import</span> <span class="n">mask</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show_hist</span>
<span class="kn">from</span> <span class="nn">rasterio.windows</span> <span class="kn">import</span> <span class="n">Window</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">reshape_as_raster</span><span class="p">,</span> <span class="n">reshape_as_image</span>

<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">mapping</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">resample</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># ipywidgets is used to create a progress bar</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">IntProgress</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div>

<h2 id="import-data">Import Data<a class="headerlink" href="#import-data" title="Permanent link">&para;</a></h2>
<p>We'll be using supervised classification techniques. We'll need both labels and predictor features to train the models. Our labels will come from the mapped STM derived from NRCS data. To begin, we'll use vegetation data as predictors, including cover estimates for trees, shrubs, perennial grasses and forbs, and bare ground.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># CHANGE TO VEG_COVER_PATH </span>
<span class="c1"># Read in features and training data</span>
<span class="n">train_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;D:\ArcGIS\Colorado\General\Rangelands_App\for-analysis\train_clip_utm.tif&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">train_path</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">crs</span>  <span class="c1"># Check the projection, all features must share a projection</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>CRS.from_dict(init=&#39;epsg:26913&#39;)
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">labels_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;D:\ArcGIS\Colorado\General\Rangelands_App\for-analysis\labels.shp&#39;</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">labels_path</span><span class="p">)</span>
<span class="n">labels</span><span class="o">.</span><span class="n">crs</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>{&#39;init&#39;: &#39;epsg:26913&#39;}
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="mf">6136</span>
</code></pre></div>

<p>We have 6,136 labeled polygons, represented within a geopandas dataframe, while our predictor features are represented in a rasterio raster. Both share the same projection.</p>
<h2 id="explore-data-and-preparation-steps">Explore Data and Preparation Steps<a class="headerlink" href="#explore-data-and-preparation-steps" title="Permanent link">&para;</a></h2>
<p>To train the classifiers, we'll need to associate our vector data (labels as polygons) with our raster pixels (predictor features). We'll accomplish this with the rasterio mask function. The mask function will essentially clip (or mask) our raster with each polygon. First, we'll want to extract the geometry of each feature in the labels shapefile to GeoJSON format.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># this generates a list of shapely geometries</span>
<span class="n">geoms</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span> 

<span class="c1"># let&#39;s grab a single shapely geometry to check</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="n">geoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is a shapely polygon&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">geometry</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>

<span class="c1"># transform to GeoJSON format (note &#39;mapping&#39; is in the shapely namespace)</span>
<span class="n">feature</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="p">(</span><span class="n">geometry</span><span class="p">)]</span>  <span class="c1"># can also do this using polygon.__geo_interface__</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is the same polygon in GeoJSON format&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">feature</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>This is a shapely polygon
&lt;class &#39;shapely.geometry.polygon.Polygon&#39;&gt;
POLYGON ((155090.8039999995 4317864.1029, 155095.9642000003 4317847.2246, 155096.9452999998 4317767.406400001, 155079.9972999999 4317764.4924, 155013.6201999998 4317772.8774, 154946.0262000002 4317762.761399999, 154906.4253000002 4317765.351500001, 154878.2922999999 4317781.742900001, 154874.5252 4317788.509099999, 154877.2857999997 4317829.973099999, 154890.6249000002 4317873.230799999, 154892.2852999996 4317898.202400001, 154873.1852000002 4318020.8462, 154866.6454999996 4318032.8059, 154861.3509 4318094.8554, 154880.1355999997 4318314.824999999, 154876.2439000001 4318350.6874, 154879.5504999999 4318400.631100001, 154884.4243000001 4318410.842, 154890.0175999999 4318527.3519, 154897.2582 4318573.0209, 154890.3213 4318594.527100001, 154894.7226999998 4318598.269300001, 154913.1912000002 4318593.0416, 154946.1224999996 4318553.260600001, 154952.6897 4318463.052999999, 154967.4232000001 4318401.3926, 154951.2766000004 4318220.3751, 154975.3370000003 4318141.542099999, 155019.5067999996 4318081.9695, 155041.7379000001 4318038.8718, 155041.0279000001 4317965.691199999, 155054.3926999997 4317914.6457, 155080.8075000001 4317871.2906, 155090.8039999995 4317864.1029))
This is the same polygon in GeoJSON format
&lt;class &#39;list&#39;&gt;
[{&#39;type&#39;: &#39;Polygon&#39;, &#39;coordinates&#39;: (((155090.80399999954, 4317864.1029), (155095.96420000028, 4317847.2246), (155096.9452999998, 4317767.406400001), (155079.99729999993, 4317764.4924), (155013.62019999977, 4317772.8774), (154946.0262000002, 4317762.761399999), (154906.42530000024, 4317765.351500001), (154878.29229999986, 4317781.742900001), (154874.52520000003, 4317788.509099999), (154877.28579999972, 4317829.973099999), (154890.62490000017, 4317873.230799999), (154892.28529999964, 4317898.202400001), (154873.18520000018, 4318020.8462000005), (154866.64549999963, 4318032.8059), (154861.35089999996, 4318094.8554), (154880.1355999997, 4318314.824999999), (154876.24390000012, 4318350.6874), (154879.5504999999, 4318400.631100001), (154884.42430000007, 4318410.842), (154890.0175999999, 4318527.3519), (154897.25820000004, 4318573.0209), (154890.32129999995, 4318594.5271000005), (154894.7226999998, 4318598.269300001), (154913.19120000023, 4318593.0416), (154946.1224999996, 4318553.260600001), (154952.6897, 4318463.052999999), (154967.42320000008, 4318401.3926), (154951.27660000045, 4318220.3751), (154975.3370000003, 4318141.542099999), (155019.50679999962, 4318081.9695), (155041.73790000007, 4318038.8718), (155041.0279000001, 4317965.691199999), (155054.39269999973, 4317914.6457), (155080.8075000001, 4317871.2906), (155090.80399999954, 4317864.1029)),)}]
</code></pre></div>

<p>Now let's extract the raster values within each polygon using the <a href="https://rasterio.readthedocs.io/en/latest/api/rasterio.mask.html">rasterio mask() function</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="n">out_image</span><span class="p">,</span> <span class="n">out_transform</span> <span class="o">=</span> <span class="n">mask</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">out_image</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>(6, 32, 10)
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">show</span><span class="p">(</span><span class="n">out_image</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>

<p><img alt="png" src="../machine-learning-tutorial_files/machine-learning-tutorial_18_0.png" /></p>
<div class="codehilite"><pre><span></span><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0xbea5c5b70&gt;
</code></pre></div>

<p>As you can see, the features raster was clipped to a single polygon. There are 6 bands and 32x10 pixels. We'll repeat this process for all 6,136 polygons to build our dataset. We'll also need to clean this raster up a bit before we use it in training. We'll explore all of this next. </p>
<p>But first, we'll be doing a lot of memory intensive work so we'll close the dataset for now.</p>
<div class="codehilite"><pre><span></span><code><span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<h2 id="build-the-training-data-for-sckit-learn">Build the Training Data for <code>sckit-learn</code><a class="headerlink" href="#build-the-training-data-for-sckit-learn" title="Permanent link">&para;</a></h2>
<p>We'll repeat the above process for all features in the shapefile and create an array <code>X</code> that has all the pixels and an array <code>y</code> that has all the training labels.</p>
<p>Note that the column 'MuleDeer_1' in the labels geodataframe has the label we're after.
TODO: change to column with label instead of numeric.</p>
<div class="codehilite"><pre><span></span><code><span class="o">%%</span><span class="n">time</span>
<span class="c1"># Lets create a progress bar as this step can take some time</span>
<span class="n">p_bar</span> <span class="o">=</span> <span class="n">IntProgress</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">geoms</span><span class="p">),</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Processing&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">p_bar</span><span class="p">)</span>

<span class="c1"># Set up arrays</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>  <span class="c1"># pixels for training</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">)</span>  <span class="c1"># labels for training</span>

<span class="c1"># extract the raster values within the polygon</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">train_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">band_count</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">count</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">geom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">geoms</span><span class="p">):</span>  <span class="c1"># Note geoms was created above</span>
        <span class="n">feature</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="p">(</span><span class="n">geom</span><span class="p">)]</span>

        <span class="c1"># the mask function returns an array of the raster pixels within this feature</span>
        <span class="n">out_image</span><span class="p">,</span> <span class="n">out_transform</span> <span class="o">=</span> <span class="n">mask</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># eliminate all the pixels with 0 values for all bands - AKA not actually part of the shapefile</span>
        <span class="n">out_image_trimmed</span> <span class="o">=</span> <span class="n">out_image</span><span class="p">[:,</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">out_image</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
        <span class="c1"># eliminate all the pixels with 255 values for all bands  - AKA not actually part of the shapefile</span>
        <span class="n">out_image_trimmed</span> <span class="o">=</span> <span class="n">out_image_trimmed</span><span class="p">[:,</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">out_image_trimmed</span> <span class="o">==</span> <span class="mi">255</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
        <span class="c1"># reshape the array to [pixel count, bands]</span>
        <span class="n">out_image_reshaped</span> <span class="o">=</span> <span class="n">out_image_trimmed</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">band_count</span><span class="p">)</span>
        <span class="c1"># append the labels to the y array</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="s2">&quot;MuleDeer_1&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]]</span> <span class="o">*</span> <span class="n">out_image_reshaped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># ???</span>
        <span class="c1"># stack the pixels onto the pixel array</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">out_image_reshaped</span><span class="p">))</span>
        <span class="c1"># increment the progress bar</span>
        <span class="n">p_bar</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span><span class="mi">1</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>IntProgress(value=0, description=&#39;Processing&#39;, max=6136)


Wall time: 25min 33s
</code></pre></div>

<h4 id="save-the-output">Save the output<a class="headerlink" href="#save-the-output" title="Permanent link">&para;</a></h4>
<p>We'll save the output as a numpy array to avoid the long process of rebuilding the features in the future. This will also allow us to share this analysis with others without them needing access to the input data. If this were not a tutorial, I might have ended the notebook here and started a new one for the remainder of the analysis.</p>
<p>I've commented out the load statements below, uncomment to load in the saved features and labels.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Save features and labels</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;E:/lulc-features.npy&#39;</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;E:/lulc-labels.npy&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># Load in data</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;E:/lulc-features.npy&#39;</span><span class="p">)</span>  <span class="c1"># fill in path</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;E:/lulc-labels.npy&#39;</span><span class="p">)</span>
</code></pre></div>

<h3 id="splitting-the-data-for-testing">Splitting the data for testing<a class="headerlink" href="#splitting-the-data-for-testing" title="Permanent link">&para;</a></h3>
<p>In order to evaluate the accuracy of our model, we'll reserve a subset of the data for testing. The <code>train_test_split</code> function allows us to quickly and randomly subset our data for this purpose.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># split out 30% of data for testing. Random state set for reproducibility.</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<h3 id="pairing-y-with-x">Pairing y with X<a class="headerlink" href="#pairing-y-with-x" title="Permanent link">&para;</a></h3>
<p>Now that we have the image we want to classify (X_train) and the land cover labels (y_train), let's check to make sure they match in size so we can feed them to our models.</p>
<div class="codehilite"><pre><span></span><code><span class="n">st_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The training data include </span><span class="si">{n}</span><span class="s1"> classes: </span><span class="si">{classes}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">st_names</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> 
                                                                <span class="n">classes</span><span class="o">=</span><span class="n">st_names</span><span class="p">))</span>

<span class="c1"># We will need a &quot;X&quot; matrix containing our features, and a &quot;y&quot; array containing our labels</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Our X matrix is sized: </span><span class="si">{sz}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sz</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Our y array is sized: </span><span class="si">{sz}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sz</span><span class="o">=</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="nv">The</span> <span class="nv">training</span> <span class="nv">data</span> <span class="k">include</span> <span class="mi">5</span> <span class="nv">classes</span>: [<span class="s1">&#39;</span><span class="s">Encroached Shrub</span><span class="s1">&#39;</span> <span class="s1">&#39;</span><span class="s">Loamy Bottom</span><span class="s1">&#39;</span> <span class="s1">&#39;</span><span class="s">P-J</span><span class="s1">&#39;</span> <span class="s1">&#39;</span><span class="s">Perennial Shrub</span><span class="s1">&#39;</span>
 <span class="s1">&#39;</span><span class="s">Wet/Salt Meadow</span><span class="s1">&#39;</span>]

<span class="nv">Our</span> <span class="nv">X</span> <span class="nv">matrix</span> <span class="nv">is</span> <span class="nv">sized</span>: <span class="ss">(</span><span class="mi">4755679</span>, <span class="mi">6</span><span class="ss">)</span>
<span class="nv">Our</span> <span class="nv">y</span> <span class="nv">array</span> <span class="nv">is</span> <span class="nv">sized</span>: <span class="ss">(</span><span class="mi">4755679</span>,<span class="ss">)</span>
</code></pre></div>

<p>That looks good. We have 5 classes (i.e., our STM names); 6 predictor features (i.e., the 6 bands in our X matrix, now flattened; and both the X and y array are the same length.</p>
<p>We'll treat these vegetation cover values as spectral signatures, and plot each to make sure they're actually separable since all we're going by in this classification is pixel values.</p>
<div class="codehilite"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>

<span class="c1"># bands are numbered 1 through 6 following GDAL convention</span>
<span class="n">band_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>

<span class="n">classes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="k">for</span> <span class="n">class_type</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
    <span class="n">band_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">y_train</span><span class="o">==</span><span class="n">class_type</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">band_count</span><span class="p">,</span> <span class="n">band_intensity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">class_type</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">band_count</span><span class="p">,</span> <span class="n">band_intensity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">class_type</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">band_count</span><span class="p">,</span> <span class="n">band_intensity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">class_type</span><span class="p">)</span>
<span class="c1">#plot them as lines</span>

<span class="c1"># Add some axis labels</span>
<span class="c1"># Add some axis labels</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Band #&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reflectance Value&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reflectance Value&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Band #&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Reflectance Value&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Band #&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span>

<span class="c1"># Add a title</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Band Intensities Full Overview&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Band Intensities Lower Ref Subset&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Band Intensities Higher Ref Subset&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<p><img alt="png" src="../machine-learning-tutorial_files/machine-learning-tutorial_36_0.png" /></p>
<p>Looks like each class will be easily separable.</p>
<p>This will be a helper function to convert class labels into indices so we're predicting to integers instead of strings.
TODO: switch labels and numbers</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">str_class_to_int</span><span class="p">(</span><span class="n">class_array</span><span class="p">):</span>
    <span class="n">class_array</span><span class="p">[</span><span class="n">class_array</span> <span class="o">==</span> <span class="s1">&#39;P-J&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">class_array</span><span class="p">[</span><span class="n">class_array</span> <span class="o">==</span> <span class="s1">&#39;Perennial Shrub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">class_array</span><span class="p">[</span><span class="n">class_array</span> <span class="o">==</span> <span class="s1">&#39;Encroached Shrub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">class_array</span><span class="p">[</span><span class="n">class_array</span> <span class="o">==</span> <span class="s1">&#39;Loamy Bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">class_array</span><span class="p">[</span><span class="n">class_array</span> <span class="o">==</span> <span class="s1">&#39;Wet/Salt Meadow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="k">return</span><span class="p">(</span><span class="n">class_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
</code></pre></div>

<h2 id="training-the-classifier">Training the Classifier<a class="headerlink" href="#training-the-classifier" title="Permanent link">&para;</a></h2>
<p>Now that we have our X matrix of feature inputs (the vegetation cover bands) and our y array (the labels), we can train our model.</p>
<p>Visit <a href="https://scikit-learn.org/stable/modules/naive_bayes.html#gaussian-naive-bayes">this web page</a> to find the usage of GaussianNaiveBayes Classifier from <code>scikit-learn</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="n">gnb</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
<span class="n">gnb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">GaussianNB</span><span class="p">(</span><span class="n">priors</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">var_smoothing</span><span class="o">=</span><span class="mf">1e-09</span><span class="p">)</span>
</code></pre></div>

<p>It's that simple to train a classifier in <code>sckit-learn</code>. The hard part is often validation and interpretation.</p>
<h3 id="validation">Validation<a class="headerlink" href="#validation" title="Permanent link">&para;</a></h3>
<p>To see how well our classifier worked, we could use the test data we partioned earlier. However, we may want to adjust the model if our results are not as accurate as we'd like. This could lead to overfitting by 'leaking' information from the test set into our training of the model. Overfitting will hurt the performance of our model on predicting novel data, and will lead to inflated accuracy metrics. </p>
<p>So how do we evaluate our model at this stage? <a href="https://scikit-learn.org/stable/modules/cross_validation.html">Cross-validation</a>. There are a few options for cross-validation, but for our purposes k-fold cross validation will work. </p>
<div class="codehilite"><pre><span></span><code><span class="c1"># 5-fold cross validation</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">gnb</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

<p><code>scores</code> stores the results of computing the score 5 consecutive times (with different splits each time)</p>
<div class="codehilite"><pre><span></span><code><span class="n">scores</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>array([0.59125447, 0.59230899, 0.59061017, 0.59067851, 0.59257414])
</code></pre></div>

<p>The mean score and the 95% confidence interval of the score estimate are hence given by:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">Accuracy</span><span class="o">:</span> <span class="mf">0.59</span> <span class="o">(+/-</span> <span class="mf">0.002</span><span class="o">)</span>
</code></pre></div>

<h2 id="improving-model-accuracy">Improving Model Accuracy<a class="headerlink" href="#improving-model-accuracy" title="Permanent link">&para;</a></h2>
<h3 id="standardizing-values">Standardizing Values<a class="headerlink" href="#standardizing-values" title="Permanent link">&para;</a></h3>
<p>The accuracy is not as good as we'd like. How can we improve the accuracy of the model? One option is to <a href="https://scikit-learn.org/stable/modules/preprocessing.html#standardization-or-mean-removal-and-variance-scaling">standardize</a> the data so that each of the features are similar in magnitude. This avoids some higher values from overwhelming lower values. It is often necessary to complete this step, depending on the model used.</p>
<p><code>sklearn</code> provides a <code>preprocessing</code> module that facilitate this scaling.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Hide warnings for converting ints to floats (or save X, y as float64 type)</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">gnb</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">GaussianNB</span><span class="p">())</span>
<span class="n">cross_val_score</span><span class="p">(</span><span class="n">gnb</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>array([0.59125447, 0.59230899, 0.59061017, 0.59067851, 0.59257414])
</code></pre></div>

<p>The accuracy is exactly the same! This is because the Gaussian Naive Bayes is robust to scaling. <a href="https://stats.stackexchange.com/questions/254723/standardisation-in-naive-bayes/348165">In essence Gaussian Naive Bayes performs standardization internally</a>.</p>
<h3 id="balancing-classes">Balancing Classes<a class="headerlink" href="#balancing-classes" title="Permanent link">&para;</a></h3>
<p>Unbalanced classes can also impact the accuracy of a model. Imagine you have data on a rare disease that only 0.01% of people have. A simple model that predicts everyone does not have the disease would be right 99.99% of the time! To get a model that can actually predict when people do have the disease, you'll need to address the imbalanced classes.</p>
<p>Again, this is an issue depending on the model used. We'll try a different type of model later in the tutorial that is more robust to imbalanced data (Random Forests). </p>
<p>To balance the data, you can either down-sample the over-represented classes or up-sample the under-represented classes. </p>
<h4 id="how-unbalanced-are-the-classes-now">How unbalanced are the classes now?<a class="headerlink" href="#how-unbalanced-are-the-classes-now" title="Permanent link">&para;</a></h4>
<p>Let's quickly plot the number of each label so we know how unbalanced the data are.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df_plot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">df_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x22899b1eda0&gt;
</code></pre></div>

<p><img alt="png" src="../machine-learning-tutorial_files/machine-learning-tutorial_60_1.png" /></p>
<p>We'll try up-sampling first so we don't reduce the number of data points too much. How much to upsample? We'll resample each of the less represented features with replacement to get the number of features contained in the most represented class.</p>
<div class="codehilite"><pre><span></span><code><span class="n">df_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>P-J                 2877442
Perennial Shrub     1388305
Encroached Shrub     375820
Loamy Bottom          85357
Wet/Salt Meadow       28755
Name: 0, dtype: int64
</code></pre></div>

<p>This will be easier with a pandas DataFrame, so let's convert our data to a DataFrame.</p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]),</span> 
     <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_train</span><span class="p">)],</span> 
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
    </tr>
    <tr>
      <th>label</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>P-J</th>
      <td>18</td>
      <td>19</td>
      <td>12</td>
      <td>12</td>
      <td>11</td>
      <td>13</td>
    </tr>
    <tr>
      <th>P-J</th>
      <td>9</td>
      <td>9</td>
      <td>7</td>
      <td>8</td>
      <td>7</td>
      <td>13</td>
    </tr>
    <tr>
      <th>P-J</th>
      <td>18</td>
      <td>24</td>
      <td>21</td>
      <td>22</td>
      <td>20</td>
      <td>20</td>
    </tr>
    <tr>
      <th>Perennial Shrub</th>
      <td>14</td>
      <td>18</td>
      <td>16</td>
      <td>12</td>
      <td>14</td>
      <td>13</td>
    </tr>
    <tr>
      <th>P-J</th>
      <td>4</td>
      <td>5</td>
      <td>9</td>
      <td>9</td>
      <td>7</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><code><span class="n">df_shrub</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Perennial Shrub&#39;</span><span class="p">],</span>
                    <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">n_samples</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">df_shrub</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="mf">2877442</span>
</code></pre></div>

<p>Now we have the same number of Perennial Shrub classes as P-J classes, our dominant class type. Let's repeat for the remaining features. We'll loop through our labels and concatenate the results to the most represented class so that this step is robust to changes in which features we explore.</p>
<div class="codehilite"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="mf">2877442</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># Start by subsetting the most represented class</span>
<span class="n">max_class</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<span class="n">df_upsampled</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">max_class</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">labels</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">max_class</span><span class="p">)</span>

<span class="c1"># For each label, resample the features to balance classes and append</span>
<span class="c1"># to the empty dataframe</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
    <span class="n">df_temp</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">label</span><span class="p">],</span>
        <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">df_upsampled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_upsampled</span><span class="p">,</span> <span class="n">df_temp</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df_upsampled</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>P-J                 2877442
Encroached Shrub    2877442
Perennial Shrub     2877442
Wet/Salt Meadow     2877442
Loamy Bottom        2877442
Name: label, dtype: int64
</code></pre></div>

<p>Now, we can split out our X and y data again and re-train the model on the more balanced classes.</p>
<div class="codehilite"><pre><span></span><code><span class="n">X_train_upsampled</span> <span class="o">=</span> <span class="n">df_upsampled</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_train_upsampled</span> <span class="o">=</span> <span class="n">df_upsampled</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># 5-fold cross validation</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">gnb</span><span class="p">,</span> <span class="n">X_train_upsampled</span><span class="p">,</span> 
                         <span class="n">y_train_upsampled</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">Accuracy</span><span class="o">:</span> <span class="mf">0.24</span> <span class="o">(+/-</span> <span class="mf">0.001</span><span class="o">)</span>
</code></pre></div>

<p>Our accuracy took a bit of a nosedive, as now we're probably over-representing those less common classes on the landscape. For the purposes of our model, it may actually be better to simply ignore those more rare classes instead of over-representing them. We could try downsampling instead, but it will likely not help our accuracy very much. Instead, let's try a different model, Random Forests.</p>
<h3 id="alternative-model-random-forests">Alternative Model: Random Forests<a class="headerlink" href="#alternative-model-random-forests" title="Permanent link">&para;</a></h3>
<p>Random Forests is robust to unscaled and unbalanced data, making it a good option for this classification problem out-of-the-box. It's not a bad idea to scale the data as we did earlier, but since our data is well scaled (percent cover data from 0 - 100%), we'll skip this step. Acknowledgements to this <a href="https://stackabuse.com/random-forest-algorithm-with-python-and-scikit-learn/">tutorial</a> used in developing this section.</p>
<div class="codehilite"><pre><span></span><code><span class="o">%%</span><span class="n">time</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="c1"># Initialize our model with 10 estimators to limit processing time</span>
<span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># 5-fold cross validation</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">Accuracy</span><span class="o">:</span> <span class="mf">0.58</span> <span class="o">(+/-</span> <span class="mf">0.001</span><span class="o">)</span>
<span class="n">Wall</span> <span class="n">time</span><span class="o">:</span> <span class="mi">3</span><span class="n">h</span> <span class="mi">13</span><span class="n">min</span> <span class="mi">13</span><span class="n">s</span>
</code></pre></div>

<p>Our accuracy (57%) is slightly less than our accuracy with the unbalanced classes using Naive Bayes (59%) but comparable.</p>
<h3 id="confusion-matrix">Confusion Matrix<a class="headerlink" href="#confusion-matrix" title="Permanent link">&para;</a></h3>
<p>We can visualize how well we're classifying each class (and where the model is getting confused) using a <a href="https://scikit-learn.org/stable/auto_examples/model_selection/plot_confusion_matrix.html#sphx-glr-auto-examples-model-selection-plot-confusion-matrix-py">confusion matrix</a>. The code for the confusion matrix is copied from the linked documentation.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.utils.multiclass</span> <span class="kn">import</span> <span class="n">unique_labels</span>

<span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span>
                          <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function prints and plots the confusion matrix.</span>
<span class="sd">    Normalization can be applied by setting `normalize=True`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Normalized confusion matrix&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Confusion matrix, without normalization&#39;</span>

    <span class="c1"># Compute confusion matrix</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="c1"># Only use the labels that appear in the data</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="n">unique_labels</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized confusion matrix&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Confusion matrix, without normalization&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1"># We want to show all ticks...</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
           <span class="n">yticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
           <span class="c1"># ... and label them with the respective list entries</span>
           <span class="n">xticklabels</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span>
           <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
           <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;True label&#39;</span><span class="p">,</span>
           <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">)</span>

    <span class="c1"># Rotate the tick labels and set their alignment.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
             <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>

    <span class="c1"># Loop over data dimensions and create text annotations.</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;.2f&#39;</span> <span class="k">if</span> <span class="n">normalize</span> <span class="k">else</span> <span class="s1">&#39;d&#39;</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fmt</span><span class="p">),</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thresh</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># Use the model to predict on the X_train dataset</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">gnb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">class_names</span> <span class="o">=</span> <span class="n">unique_labels</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># Plot normalized confusion matrix</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">class_names</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Normalized confusion matrix&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Normalized confusion matrix
[[0.00e+00 0.00e+00 8.77e-01 1.22e-01 2.90e-04]
 [0.00e+00 0.00e+00 8.13e-01 1.84e-01 2.91e-03]
 [0.00e+00 0.00e+00 8.86e-01 1.14e-01 8.17e-05]
 [0.00e+00 0.00e+00 8.01e-01 1.89e-01 9.71e-03]
 [0.00e+00 0.00e+00 7.46e-01 2.42e-01 1.17e-02]]
</code></pre></div>

<p><img alt="png" src="../machine-learning-tutorial_files/machine-learning-tutorial_82_1.png" /></p>
<p>The confusion matrix indicates that the model is catogorizing most pixels as P-J and some as Perennial Shrub, with just a few Wet Meadow predictions. It ignores Encroached Shrub and Loamy Bottom. Focusing on the final row of the matrix, you can see that the Wet/Salt Meadow is being categorized as P-J 75% of the time, Perennial Shrub 24% of the time, and its correct label only 1% of the time.</p>
<div class="codehilite"><pre><span></span><code><span class="n">y_pred_rfc</span> <span class="o">=</span> <span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># Plot normalized confusion matrix</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred_rfc</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">class_names</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Normalized confusion matrix&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Normalized confusion matrix
[[0.00e+00 0.00e+00 8.77e-01 1.22e-01 2.87e-04]
 [0.00e+00 0.00e+00 8.13e-01 1.84e-01 2.85e-03]
 [0.00e+00 0.00e+00 8.86e-01 1.14e-01 8.06e-05]
 [0.00e+00 0.00e+00 8.01e-01 1.89e-01 9.69e-03]
 [0.00e+00 0.00e+00 7.46e-01 2.42e-01 1.17e-02]]
</code></pre></div>

<p><img alt="png" src="../machine-learning-tutorial_files/machine-learning-tutorial_85_1.png" /></p>
<p>Interestingly, the confusion matrix for both the Naive Bayes and Random Forests model is the same. This may signal that we've done about as well as we could with these features. We could incorporate additional features through the same process as we went through before, considering topography, soils, precipitation, and spatial measures using distances or moving windows. We should also carefully consider feature selection to optimize the bias-variance tradeoffs. Feature engingeering and feature selection is beyond the scope of this tutorial.</p>
<p>A <a href="https://scikit-learn.org/stable/modules/model_evaluation.html#classification-report">classification report</a> will provide reportable metrics of model accuracy to allow us document the performance of the model. It reports precision, recall and the F1 score. Precision is the ability of the model to avoid false positives. Recall is the ability to identify the feature correctly (notice it is equivalent to where the diagonal axis of the confusion matrix). The F1 score is a harmonic mean of precision and recall.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">class_names</span><span class="p">))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>C:\Users\Erik\Anaconda3\lib\site-packages\sklearn\metrics\classification.py:1143: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples.
  &#39;precision&#39;, &#39;predicted&#39;, average, warn_for)


                  precision    recall  f1-score   support

Encroached Shrub       0.00      0.00      0.00    375820
    Loamy Bottom       0.00      0.00      0.00     85357
             P-J       0.62      0.89      0.73   2877442
 Perennial Shrub       0.40      0.19      0.26   1388305
 Wet/Salt Meadow       0.02      0.01      0.02     28755

       micro avg       0.59      0.59      0.59   4755679
       macro avg       0.21      0.22      0.20   4755679
    weighted avg       0.49      0.59      0.52   4755679
</code></pre></div>

<p>​    </p>
<h2 id="predicting-on-the-image">Predicting on the Image<a class="headerlink" href="#predicting-on-the-image" title="Permanent link">&para;</a></h2>
<p>With our classifier fit, we can now proceed by trying to classify the entire image.</p>
<div class="codehilite"><pre><span></span><code><span class="n">range_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;D:\ArcGIS\Colorado\General\Rangelands_App\for-analysis\range_clip_utm.tif&#39;</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">range_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>  <span class="c1"># the src profile will be used to save the output later</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># Take our full iamge and reshape into long 2d array (nrow * ncol, nband) for classification</span>
<span class="nb">print</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">reshaped_img</span> <span class="o">=</span> <span class="n">reshape_as_image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reshaped_img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>(6, 9412, 7341)
(9412, 7341, 6)
</code></pre></div>

<p>Now we can predict for each pixel in our image.</p>
<div class="codehilite"><pre><span></span><code><span class="n">class_prediction</span> <span class="o">=</span> <span class="n">gnb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">reshaped_img</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Reshape our classification map back into a 2d matrix so we can visualize it</span>
<span class="n">class_prediction</span> <span class="o">=</span> <span class="n">class_prediction</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">reshaped_img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>

<p>Because we used labels as strings we will want to convert them to numpy array with integers using the helper function we made earlier.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># This function converts the class prediction to ints from strings because it was originally created as a string</span>
<span class="c1"># See template notebook for more</span>
<span class="n">class_prediction</span> <span class="o">=</span> <span class="n">str_class_to_int</span><span class="p">(</span><span class="n">class_prediction</span><span class="p">)</span>
</code></pre></div>

<h3 id="visualize-the-results">Visualize the Results<a class="headerlink" href="#visualize-the-results" title="Permanent link">&para;</a></h3>
<p>First we'll make a colormap so we can adjust the colors of each class to more logical colors. </p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">color_stretch</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">colors</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">adjust_band</span><span class="p">(</span><span class="n">colors</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">b</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">colors</span>

<span class="c1"># find the highest pixel value in the prediction image</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">class_prediction</span><span class="p">))</span>

<span class="c1"># next setup a colormap for our map</span>
<span class="n">colors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">255</span><span class="p">)),</span>    <span class="c1"># Forest Green - PJ</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">139</span><span class="p">,</span><span class="mi">69</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span> <span class="mi">255</span><span class="p">)),</span>      <span class="c1"># Brown - Perennial Shrub</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">214</span><span class="p">,</span> <span class="mi">255</span><span class="p">)),</span>   <span class="c1"># Blue - Encroached Shrub</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">244</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">255</span><span class="p">)),</span>   <span class="c1"># Tan - Loamy Bottom</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">206</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">255</span><span class="p">)),</span>  <span class="c1"># Lime - Grass Meadow</span>
<span class="p">))</span>

<span class="c1"># Put 0 - 255 as float 0 - 1</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="n">_v</span> <span class="o">=</span> <span class="p">[</span><span class="n">_v</span> <span class="o">/</span> <span class="mf">255.0</span> <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
    <span class="n">colors</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_v</span>

<span class="n">index_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">colors</span> <span class="k">else</span>
               <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">index_colors</span><span class="p">,</span> <span class="s1">&#39;Classification&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">show</span><span class="p">(</span><span class="n">class_prediction</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../machine-learning-tutorial_files/machine-learning-tutorial_99_0.png" /></p>
<div class="codehilite"><pre><span></span><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0xbeb7d2278&gt;
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">Env</span><span class="p">():</span>

    <span class="n">profile</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">compress</span><span class="o">=</span><span class="s1">&#39;lzw&#39;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;D:\ArcGIS\Colorado\General\Rangelands_App\for-analysis\example.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">class_prediction</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">rasterio</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<h2 id="improving-our-model-accuracy">Improving our Model Accuracy<a class="headerlink" href="#improving-our-model-accuracy" title="Permanent link">&para;</a></h2>
<p>In the following sections (TBD), we'll improve upon our model, evaluate accuracy, and explore different classifiers
* Normalize values
* Split into training and testing data
* Balance classes in training data
* Introduce additional features (elevation, precip, soil temperature, aspect, moving window stats, imagery)
* Explore different classifiers
* Feature Importance
* Parameter tuning
* Correlations</p>
<p><a href="https://scikit-learn.org/stable/modules/model_evaluation.html">Evaluation</a></p>
<p><a href="https://scikit-learn.org/stable/modules/model_evaluation.html#accuracy-score">Accuracy</a></p>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../../../data-management/neo4j-advanced/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Neo4j Advanced
            </div>
          </div>
        </a>
      
      
        <a href="../../../data-visualization/data-visualization/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Data Visualization
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Environmental Incentives
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.5cf3e710.min.js"></script>
      
        <script src="../../../js/scripts.js"></script>
      
    
  </body>
</html>